#!/usr/bin/env ruby

$LOAD_PATH << File.join(File.dirname(__FILE__), 'lib')

require "menu"
require "server"
require "games"
require "ui"

begin
  Dir.chdir Server::SERVER_DIR
  Menu.initialize
  Signal.trap "HUP" do
    Menu.destroy
    puts "Caught HUP"
    if Games.socket != nil then
      system "screen", "-D", Games.socket
    end
    Process.exit(1)
  end
  #pid = fork do
  #  until UI.stdout_dead? do sleep 1 end
  #  Process.kill "HUP", Process.ppid
  #end
  Menu.mainmenu
ensure
  Menu.destroy
end
