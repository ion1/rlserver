#!/usr/bin/env ruby

$LOAD_PATH << File.join(File.dirname(__FILE__), 'lib')

require "menu"
require "server"

begin
  Dir.chdir Server::SERVER_DIR
  Server.initialize
  Menu.initialize
  Signal.trap "HUP" do
    puts "Caught HUP"
    Games.populate
    i = Games.index Menu.user
    unless Games.index i < 0 then
      system "screen", "-D", Games.games[i].socket
    end
    exit
  end
  Menu.mainmenu
ensure
  Menu.destroy
end

